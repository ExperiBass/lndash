extends layout

block headContent
	title My Peers

block breadcrumb
	li.breadcrumb-item
		a(href='/') Home
	li.breadcrumb-item My Node
	li.breadcrumb-item My Peers
	
block content
	if (!session.admin)
		h1.h3 My Peers
		hr

		- var loginRequiredNote = "display details about this node's peers.";
		include includes/login-required-alert.pug

	else

		+pageTitle(`${listPeers.peers.length.toLocaleString()} Peer${(listPeers.peers.length == 1) ? "" : "s"}`)

		
		+card
			+filterList
				+filterItem
					- var sortOptions = [["Public Key", "pubkey-asc"], ["Alias", "alias-asc"], ["IP Addr", "ip-asc"], ["Value Transferred", "valuetransfer-desc"], ["Data Transferred", "datatransfer-desc"]];

					+filterBtnGroup("Sort", null, sortOptions, `/peers?limit=${limit}`, "sort", sort)


				+filterItem(true)
					- var pageSizeOptions = [["20", "20"], ["50", "50"], ["100", "100"]];

					+filterBtnGroup("Page Size", null, pageSizeOptions, `/peers?sort=${sort}`, "limit", limit)

		

			hr.my-3

			div
				if (allFilteredPeers.length > limit)
					span Showing 
					span.fw-bold ##{(offset + 1).toLocaleString()} - #{Math.min(offset + limit, allFilteredPeers.length).toLocaleString()} 
					span of 
					span.fw-bold #{allFilteredPeers.length.toLocaleString()} 
					if (allPeers.length > allFilteredPeers.length)
						span filtered 
					span peer
					if (allFilteredPeers.length != 1)
						span s

				else if (allFilteredPeers.length > 0)
					span Showing 
					span.fw-bold #{allFilteredPeers.length.toLocaleString()} 
					if (allPeers.length > allFilteredPeers.length)
						span filtered 

					span peer
					if (allFilteredPeers.length > 1)
						span s
				else
					.alert.alert-warning.shadow-sm.mb-0 No matching peers

			- var itemCount = allFilteredPeers.length;
			if (itemCount > limit)
				- var pageNumber = offset / limit + 1;
				- var pageCount = Math.floor(itemCount / limit);
				- if (pageCount * limit < itemCount) {
					- pageCount++;
				- }
				- var paginationUrlFunction = function(x) {
					- return paginationBaseUrl + `&limit=${limit}&offset=${((x - 1) * limit)}`;
				- }
				
				.mt-2.mb-0
					include includes/pagination.pug


		.table-responsive
			table.table.table-striped
				thead.table-head-with-nav
					tr
						th.text-end.fw-light #
						th Node
						th Address

						th.text-end Value Transfer
						th.text-end Data Transfer
						
						th.text-center Inbound?
						th.text-end Ping

				tbody
					each item, item_index in pagedFilteredPeers
						tr
							th.text-end.fw-light #{(item_index + offset + 1).toLocaleString()}

							td
								- var card_node_pubkey = item.pub_key;
								include ./includes/node-card.pug

							td
								+netAddress(item.address)
								

							td.text-end
								if (item.sat_recv == 0 && item.sat_sent == 0)
									span -
								else
									if (item.sat_recv > 0)
										span.badge.text-bg-success.fs-100
											span +
											+btcValue(item.sat_recv)

										br

									if (item.sat_sent > 0)
										span.badge.text-bg-danger.fs-100
											span -
											+btcValue(item.sat_sent)
							
							
							- var bytesSentData = utils.formatLargeNumber(item.bytes_sent, 1);
							- var bytesRecvData = utils.formatLargeNumber(item.bytes_recv, 1);
							
							td.text-end
								span #{bytesSentData[0]} #{bytesSentData[1].abbreviation}B
								i.fas.fa-arrow-up.ms-2
								
								br

								span #{bytesRecvData[0]} #{bytesRecvData[1].abbreviation}B
								i.fas.fa-arrow-down.ms-2
								

							

							td.text-center.align-middle
								if (item.inbound)
									i.fas.fa-circle-check.text-success
								else
									i.fas.fa-circle-xmark.text-danger

							td.text-end #{parseInt(item.ping_time).toLocaleString()}